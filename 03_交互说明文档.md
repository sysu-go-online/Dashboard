# 交互说明文档

## Debug调试交互

### 客户端与api服务端

客户端操作时，前端会通过websocket连接发送对应的请求到api服务端，并将从api服务端接收到的信息处理后显示到前端页面，流程如下：

1. 用户添加断点时，前端将用户断点记录进入前端数组中
2. 用户启动调试时，建立websocket连接，收到api服务端的消息后，进入调试界面(此处使用单页页面，包含编辑和调试两种视图，前端负责切换)
3. 前端不停读取api服务发来的状态信息
4. 若收到`stop`指令，则根据相应的信息，在前端展示stop状态
5. 若收到`finish`指令，则显示完成调试
6. 若收到`output`指令，则在前端的`Debug Console`中打印传回的程序输出结果
7. 程序终止后，关闭websocket连接，等待用户回到编辑界面

**注意：由于gdb的原因，每条消息必须在收到上一条消息的反馈之后才能发送，第一条消息必须收到文件载入事件的反馈才能发送**

### api服务端与容器端

api服务端接到请求时会尝试连接容器端，并将用户传来的参数进行解析后传递对应的命令给容器端，容器端将会把从调试服务端获得的信息传给api服务端处理，流程如下：

1. 接到用户创建连接的请求后，解析相关信息(暂时使用默认值)，打包成json传给容器端
2. 监听用户端请求，收到请求后，解析后生成gdb命令，发往容器端(貌似gdb在一条指令完成前，接收的指令都会失效，这里还没有解决这个问题)
3. 监听容器端发回的信息，解析确定信息内容和客户端事件后，打包发回前端
4. 容器端或客户端任意一个断开连接之后，断开另一方的连接

### 容器端与调试服务端

容器收到api服务端发来的调试请求后，会首先创建并启动一个调试服务端容器，调试服务端会对外暴露一个websocket接口，用来交换信息。创建时，容器端将会将该容器实例加入专属的调试网络中，记录下该容器的id号并尝试连接；由于容器只作为中转站，因此容器端将原封不动地将所有信息在api服务端和调试服务端之间传递

## 用户创建项目

当前支持的项目语言有：golang、cpp

### 公共参数

- name
  项目名，每个用户的项目名唯一，作为该项目的唯一标记
  
 - description
  描述，用来描述该项目简要信息
  
 - language
  语言，支出该项目使用何种语言，具体语言和数字的对应参照对应表
  
 - git_path
  项目的远程git仓库地址，可为空
  
 - setting
  配置项，可为空
  
 ### golang
 
  - setting.username
    项目对应的用户名，当项目的创建者名称和当前用户用户名不一致时使用，项目文件的挂载地址以该用户名为准
    
## 系统指令交互

后台将会对用户在终端输入的指令进行拦截，当用户输入的指令以`go-online `开头时，系统将会视该条命令为内置命令直接解析，而不是交由容器执行，因为这些命令可能会改变系统状态而无法在容器中完成

### 用户进行端口映射

`go-online map OPTIONS "COMMAND [ARGS...]"`


```
Options:
  -p port 提供将要映射的端口号
```

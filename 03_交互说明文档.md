# 交互说明文档

## 用户操作终端、修改终端宽度、增加端口映射 [/ws/tty]

### 前端与api服务端(ws)

#### 前端传入部分

|名称|类型|是否必须|说明|
|-|-|-|-|
|jwt|string|否|用户登录获得的jwt，在初次连接时需要|
|project|string|否|当前所在项目名|
|type|int|是|说明当前信息类型，具体见**用户终端交互类型表**|
|msg|string|是|用户的输入字符流或相应的菜单命令|
|language|int|否|当用户需要自行指定或更换编程语言时，此项为语言的代号，若为`-2`，则使用空镜像，默认情况下将沿用用户上次使用的语言环境，第一次启动环境将使用ubuntu空镜像|
|height|int|否|前端终端的高度|
|width|int|否|前端终端的宽度|
|port|int|否|希望暴露的端口|

**1. 当length和width中均不为0时，则代表修改尺寸为所给值**

**2. 切换语言由前端负责，需断开原有连接后重新创建连接并传入相关参数**

#### 服务端返回部分

|名称|类型|是否必须|说明|
|-|-|-|-|
|ok|bool|是|是否连接成功|
|type|int|是|返回的消息类型，具体见**用户终端交互类型表**|
|msg|string|是|连接成功则为后台终端的输出值，包括stdout和stderr；连接失败则为说明信息|

### api服务端与容器端

#### 后台请求容器端创建容器(restful post /create)

##### 容器端传入部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|image|string|是|指明需要启动容器的镜像|
|pwd|string|否|当前的用户路径|
|env|[]string|否|额外环境变量|
|mnt|[]string|否|指明被挂载目录在系统中的位置，空则表示不进行挂载|
|target|[]string|否|指明上面给出的目录应该挂载到容器的某一具体位置|
|network|[]string|是|指明用户的容器所在虚拟网络名称|

##### 容器端传回部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|id|string|是|容器id|
|ok|bool|是|指明当前创建是否成功|
|msg|string|否|相关说明信息|

#### 后台请求更改容器窗口大小(restful post /resize)

##### 容器端传入部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|id|int|是|目标容器的id|
|width|int|是|目标终端宽度|
|height|int|是|目标终端高度|

##### 容器端传回部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|ok|bool|是|是否成功|
|msg|string|否|相关信息|

#### 后台请求修改容器网络(restful post /network)

##### 容器端传入部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|id|int|是|目标容器的id|
|network|[]string|是|目标网络列表|

##### 容器端传回部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|ok|bool|是|是否成功|
|msg|string|否|相关信息|

#### 后台请求连接到容器(ws /tty)

##### 容器端传入部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|id|string|是|需要连接容器的id，仅第一次需要包含|
|msg|string|是|需要写入容器的信息|

##### 容器端传回部分
|名称|类型|是否必须|说明|
|-|-|-|-|
|ok|string|是|指明当前是否成功连接|
|msg|string|是|当连接成功时，则包含容器的字符流；连接失败时，则包含具体说明信息|

## 获取文件目录结构实时更新 [/ws/dir]

### 前端与api服务端(ws)

#### 前端传入部分

前端仅在连接之后发送一次消息验证身份以及说明当前项目即可，后续不再需要发送消息

|名称|类型|是否必须|说明|
|-|-|-|-|
|jwt|string|否|用户登录获得的jwt，在初次连接时需要|
|project|string|否|当前所在项目名，在初次连接时需要|

#### 后台传回部分

|名称|类型|是否必须|说明|
|-|-|-|-|
|ok|bool|是|说明当前返回的是否为有效信息|
|path|string|是|状态发生变化的文件路径|
|state|int|是|发生的状态变化类型，具体见**数字与文件变化状态对应表**|
|type|string|是|传回路径的类型：“folder”还是“file”|
